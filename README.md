# Асинхронная версия API расписания для проекта Лицей в Цифре
### [Пользовательская документация на swagger](https://swagger.lava-land.ru/)

## Быстрая установка через Github 
### Данный вид установки не поддерживает изменение исходного кода.
### Необходимые пакеты
Установите в вашу систему python3, python3-pip, python3-venv и docker.

## Подключение API
### Домены:
У API есть две версии stable и dev, стабильная и нестабильная соответственно.
Если ваше приложение находится на стадии разработки, рекомендуется использовать
dev версию API.

Stable: https://async-api.lava-land.ru
Dev: https://test-async-api.lava-land.ru

### Как написать запрос
Чтобы получить данные из API, необходимо послать GET запрос,
состоящий из двух частей: домен и URL-путь. Запись URL-пути всегда начинается
с символа `/`. Также у нас принято не писать `/` в конце запроса.
Например, https://test-async-api.lava-land.ru/school 
вернёт список всех школ. В данном примере URL-путь это `/school`. Далее для
обозначения запроса вместо https://test-async-api.lava-land.ru/school будет 
использоваться `/school`. А также под терминами URL и адрес будет 
подразумеваться URL-путь.

Названия URL запросов выбираются на основе REST-API. 
Знать что это такое необязательно. Детальнее почитать об этом можно 
[тут](https://habr.com/ru/post/483202/"). Говоря коротко, это способ именования
запросов, в котором используется следующая схема. `/объект` - чтобы получить 
список таких объектов. И `/объект/уникальный_номер_объекта` - чтобы получить 
объект с заданным в URL уникальным номером. В нашей системе принято завершать
запрос объектом, а не уникальным номером. Например, 
вот корректный запрос `/school/1/class` - это список классов в школе,
а вот некорректный `/school/1`, он работать не будет. Обратите внимание, что
для сокращения вместо `{уникальный_номер_объекта}` в документации 
используется `1`. 


### Как получить информацию из запроса
Данные в теле запроса (в разных системах встречаются названия body, data 
или text) передаются в формате JSON. ВСЕГДА любой запрос это словарь, внутри
этого словаря могут быть списки, строки, числа, булевы значения, 
но тело запроса должно быть словарём.

Ответ от сервера на запрос получения списка объектов (например `/school`) - это 
словарь с параметрами запроса и результатами поиска. Например, для `/school`
ответом будет следующий JSON `{"schools": [...]}`. А для `/school/1/class` 
`{"class_id": 1, "classes": [...]}`. 

`[...]` - это список объектов, содержимое
таких списков будет приведено далее.

Ответ от сервера на запрос получения объекта - это JSON с атрибутами 
(свойствами, параметрами) объекта. Например, `/teacher/1/info` вернёт
`{"teacher_id": 1, "name": "Иванов Иван Иванович"}`

### Список доступных URL:
Запрос `/school`
Ответ 
```json
{
    "schools": [
        {
            "school_id": 1,
            "name": "Лицей №2",
            "address": "Иркутск, ул. ... д. ..."
        },
        {
            "school_id": 2,
            "name": "Иркутский Гос.Университет",
            "address": "Иркутск"
        }
    ]
}
```
ПРОДОЛЖЕНИЕ СЛЕДУЕТ
Запрос `/school/1/class`
```json

```

Запрос `/school/1/lesson`
```json
```

Запрос `/class/1/lesson`
```json
```

## Установить серверную часть API с GitHub (Не подходит дла разработки)
### Зависимости
Установите в вашу систему python3-pip и python3-venv. Если вы используете 
Windows OS, то при установке python3 необходимо выбрать пункт "Add python to PATH" 


### Созадание виртуального окружения и установка API 
```shell
python3 -m venv venv  # Создаёт виртуальное окружение
source ./venv/bin/activate  # Активирует виртуальное окружение
pip3 install "git+https://github.com/prostoLavr/
              async_lyceum_api.git"  # Устанавливает код из GitHub (не из вашего каталога)
```
### Запуск
```shell
# Запуск PostgreSQL через Docker
docker run --rm -it -e POSTGRES_PASSWORD="password" -d \
                 -p "5432:5432" --name "postgres" postgres:15.1 

# Раскомментируйте следующую строку, чтобы очистить базу данных. 
# psql -h 0.0.0.0 -p 5432 -U postgres -c "DROP DATABASE db" 
# Создание базы данных внутри Docker контейнера
psql -h 0.0.0.0 -p 5432 -U postgres -c "CREATE DATABASE db"

# Запуск API. Введите "async_lyceum_api --help" чтобы посмотреть остальные аргументы.
async_lyceum_api --web-port 8080
```

## Установка из исходников с помощью виртуального окружения
ПРОДОЛЖЕНИЕ СЛЕДУЕТ
### Install packages
Install python3, python3-pip, python3-venv and docker. 
Instead docker you can install postgres 15.1 but docker is recommended.
=======
### Создание виртуального окружения
Клонировать репозиторий не надо.
```shell
python3 -m venv venv  # Создание окружения
source ./venv/bin/activate  # Активация окружения
# Установка кода из GitHub через pip
pip3 install "git+https://github.com/prostoLavr/async_lyceum_api.git"
```
### Запуск
```shell
# Запуск базы данных PostgreSQL
docker run --rm -it -e POSTGRES_PASSWORD="password" -d \
                 -p "5432:5432" --name "postgres" postgres:15.1
# Запуск проекта. Чтобы узнать больше, введите async_lyceum_api --help
async_lyceum_api --web-port 8080
```

## Установка из исходников в виртуальное окружение
### Самый удобный способ дла разботки API.
### Необходимые пакеты
Установите python3, python3-pip, python3-venv и docker. 
Вместо docker вы можете использовать нативно установленную postgres 15.1, 
но использование docker предпочтительнее.
>>>>>>> dev

### Клонировение исходного кода
```shell
git clone https://github.com/prostoLavr/async_lyceum_api.git
```
### Создание виртуального окружения
```shell
python3 -m venv venv
source ./venv/bin/activate
```
### Инициализация режима разработки
Режим разработки это установка python пакета, 
обновляющегося в реальном времени. Это полезно для разработки, так как
не нужно каждый раз пересобирать и переустанавливать пакет, но после
установки собранного whl пакета этот режим деактивируется. 
```shell
pip3 install -e .  # <- Точка в конце обязательна!
```

### Запуск в режеме для разрабоки
```shell
# Запуск postgresql в docker
docker run --rm -it -e POSTGRES_PASSWORD="password" -d \
                 -p "5432:5432" --name "postgres" postgres:15.1

# Запустите "async_lyceum_api --help" чтобы узнать больше доступных аргументов.
async_lyceum_api --web-port 8080
```

## Установка в docker образ

### Необходимые пакеты
Установите в вашу систему docker и docker-compose.

### Клонирование исходного кода
```shell
git clone https://github.com/prostoLavr/async_lyceum_api.git
```
Скорее всего вы хотите проверить работу API через свой браузер. Для этого 

### Сборка пакета и запуск проекта
Использование `-f docker-compose-dev.yml` открывать порт 8080
```shell
docker build -t async-lyceum-api .  # <- Точка в конце обязательна!
docker-compose up -d -f docker-compose-dev.yml
```
